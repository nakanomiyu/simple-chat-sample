<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ã‚¹ãƒãƒ›ã‚»ãƒ³ã‚µãƒ¼é€ä¿¡</title>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <h2>ã‚¹ãƒãƒ›å‚¾ãé€ä¿¡ä¸­ğŸ“±</h2>
  <button id="startBtn">ã‚»ãƒ³ã‚µãƒ¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>

  <script>
  const socket = io.connect(window.location.origin);
  socket.emit('join', 'game');

  document.getElementById("startBtn").addEventListener("click", () => {
    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
      // iPhoneç³»ï¼ˆSafariï¼‰å‘ã‘ï¼šè¨±å¯ãƒœã‚¿ãƒ³ãŒå¿…è¦
      DeviceOrientationEvent.requestPermission()
        .then(state => {
          if (state === 'granted') startSending();
          else alert('è¨±å¯ã•ã‚Œã¦ãªã„ã‚ˆğŸ’¦');
        })
        .catch(console.error);
    } else {
      // Androidãªã©ï¼šãã®ã¾ã¾é–‹å§‹
      startSending();
    }
  });

  function startSending() {
    window.addEventListener('deviceorientation', (e) => {
      socket.emit('sensor', { g: e.gamma, b: e.beta });
    });
    document.getElementById("startBtn").style.display = "none";
  }
  </script>
</body>
</html>