<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¹ãƒãƒ›æ“ä½œç”»é¢</title>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<h2>ã‚¹ãƒãƒ›ã‚’å‚¾ã‘ã¦æ“ä½œã™ã‚‹ã‚ˆï¼</h2>
<button id="startBtn">ã‚»ãƒ³ã‚µãƒ¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>

<script>
const socket = io();

document.getElementById("startBtn").addEventListener("click", () => {
  if (typeof DeviceOrientationEvent.requestPermission === 'function') {
    // iOSç”¨ï¼šè¨±å¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    DeviceOrientationEvent.requestPermission()
      .then(permissionState => {
        if (permissionState === 'granted') {
          startSending();
        } else {
          alert('ã‚»ãƒ³ã‚µãƒ¼ã®è¨±å¯ãŒå¿…è¦ã ã‚ˆğŸ“±');
        }
      })
      .catch(console.error);
  } else {
    // Androidç”¨ï¼šãã®ã¾ã¾é–‹å§‹
    startSending();
  }
});

function startSending() {
  window.addEventListener("deviceorientation", (e) => {
    socket.emit("sensor", { g: e.gamma, b: e.beta });
  });
  document.getElementById("startBtn").style.display = "none";
}
</script>
</body>
</html>